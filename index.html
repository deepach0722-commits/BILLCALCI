<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>тЪб Smart Energy Bill Calculator</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #c9ffbf, #ffafbd);
  color: #222;
}
header {
  background: #0077b6;
  color: white;
  padding: 16px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
}
.container {
  max-width: 950px;
  margin: 20px auto;
  background: white;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.2);
}
select, input, button {
  padding: 8px;
  font-size: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
button {
  cursor: pointer;
  background: #0077b6;
  color: white;
  border: none;
  transition: 0.2s;
}
button:hover { background: #005f8a; }
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 10px;
}
.device-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}
.remove-btn { background: #ff4b5c; }
.results {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-top: 20px;
}
.card {
  background: #f4f8fb;
  border-radius: 10px;
  padding: 16px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
.ai-chat {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 300px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.chat-header {
  background: #0077b6;
  color: white;
  text-align: center;
  padding: 10px;
  font-weight: bold;
}
.chat-body {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  font-size: 14px;
}
.chat-body div { margin-bottom: 8px; }
.chat-input {
  display: flex;
  border-top: 1px solid #ccc;
}
.chat-input input {
  flex: 1;
  border: none;
  outline: none;
  padding: 8px;
}
.chat-input button {
  background: #0077b6;
  border: none;
  color: white;
  padding: 8px 12px;
}
.lang-region {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}
</style>
</head>
<body>
<header id="headerText">тЪб Smart Energy Bill Calculator</header>

<div class="container">
  <div class="lang-region">
    <label><span id="langLabel">ЁЯМР Language:</span>
      <select id="language">
        <option value="en">English</option>
        <option value="hi">рд╣рд┐рдиреНрджреА</option>
        <option value="te">р░др▒Жр░▓р▒Бр░Чр▒Б</option>
        <option value="ta">родрооро┐ро┤рпН</option>
      </select>
    </label>
    <label><span id="regionLabel">ЁЯУН Region:</span>
      <select id="region">
        <option value="ap">Andhra Pradesh</option>
        <option value="tn">Tamil Nadu</option>
        <option value="mh">Maharashtra</option>
      </select>
    </label>
  </div>

  <div id="devices"></div>

  <div class="controls">
    <button id="addDevice">+ Add Appliance</button>
    <button id="calculate">Calculate</button>
    <button id="reset">Reset</button>
  </div>

  <div class="results" id="resultsArea" style="display:none;">
    <div class="card" id="deviceDetails">
      <h3 id="deviceTitle">Device-wise Details</h3>
      <div id="deviceList"></div>
    </div>
    <div class="card" id="summary">
      <h3 id="summaryTitle">Summary</h3>
      <div id="summaryContent"></div>
    </div>
  </div>
</div>

<!-- AI Chat -->
<div class="ai-chat" id="aiChat">
  <div class="chat-header" id="chatHeader">ЁЯдЦ Smart Energy Assistant</div>
  <div class="chat-body" id="chatBody">
    <div><strong>AI:</strong> Hi! Ask me about tariffs, how to save power, or your bill.</div>
  </div>
  <div class="chat-input">
    <input id="userMsg" placeholder="Ask your question..." />
    <button id="sendMsg">Send</button>
  </div>
</div>

<script>
// ----------- Multi-language Texts -----------
const translations = {
  en: {
    header: "тЪб Smart Energy Bill Calculator",
    lang: "ЁЯМР Language:",
    region: "ЁЯУН Region:",
    add: "+ Add Appliance",
    calc: "Calculate",
    reset: "Reset",
    deviceTitle: "Device-wise Details",
    summaryTitle: "Summary",
    aiWelcome: "Hi! Ask me about tariffs, how to save power, or your bill.",
  },
  hi: {
    header: "тЪб рд╕реНрдорд╛рд░реНрдЯ рдКрд░реНрдЬрд╛ рдмрд┐рд▓ рдХреИрд▓рдХреБрд▓реЗрдЯрд░",
    lang: "ЁЯМР рднрд╛рд╖рд╛:",
    region: "ЁЯУН рдХреНрд╖реЗрддреНрд░:",
    add: "+ рдЙрдкрдХрд░рдг рдЬреЛрдбрд╝реЗрдВ",
    calc: "рдЧрдгрдирд╛ рдХрд░реЗрдВ",
    reset: "рд░реАрд╕реЗрдЯ",
    deviceTitle: "рдЙрдкрдХрд░рдг рд╡рд┐рд╡рд░рдг",
    summaryTitle: "рд╕рд╛рд░рд╛рдВрд╢",
    aiWelcome: "рдирдорд╕реНрддреЗ! рдореБрдЭрд╕реЗ рдЯреИрд░рд┐рдл, рдмрд┐рдЬрд▓реА рдмрдЪрд╛рдиреЗ рдпрд╛ рдмрд┐рд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗрдВред",
  },
  te: {
    header: "тЪб р░╕р▒Нр░ор░╛р░░р▒Нр░Яр▒Н р░Ор░ир░░р▒Нр░Ьр▒А р░мр░┐р░▓р▒Н р░Хр░╛р░▓р░┐р░Хр▒Нр░пр▒Бр░▓р▒Зр░Яр░░р▒Н",
    lang: "ЁЯМР р░нр░╛р░╖:",
    region: "ЁЯУН р░кр▒Нр░░р░╛р░Вр░др░В:",
    add: "+ р░кр░░р░┐р░Хр░░р░В р░Ьр▒Лр░бр░┐р░Вр░Ър▒Б",
    calc: "р░▓р▒Жр░Хр▒Нр░Хр░┐р░Вр░Ър▒Б",
    reset: "р░░р▒Ар░╕р▒Жр░Яр▒Н",
    deviceTitle: "р░кр░░р░┐р░Хр░░ р░╡р░┐р░╡р░░р░╛р░▓р▒Б",
    summaryTitle: "р░╕р░╛р░░р░╛р░Вр░╢р░В",
    aiWelcome: "р░╣р░▓р▒Л! р░Яр░╛р░░р░┐р░лр▒НтАМр░▓р▒Б, р░╡р░┐р░жр▒Нр░пр▒Бр░др▒Н р░кр▒Кр░жр▒Бр░кр▒Б р░▓р▒Зр░жр░╛ р░мр░┐р░▓р▒Н р░Чр▒Бр░░р░┐р░Вр░Ър░┐ р░Ер░бр░Чр░Вр░бр░┐.",
  },
  ta: {
    header: "тЪб ро╕рпНрооро╛ро░рпНроЯрпН рооро┐ройрпНроЪро╛ро░ роХроЯрпНроЯрог роХрогроХрпНроХрпАроЯрпНроЯро╛ро│ро░рпН",
    lang: "ЁЯМР роорпКро┤ро┐:",
    region: "ЁЯУН рокроХрпБродро┐:",
    add: "+ роЪро╛родройроорпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН",
    calc: "роХрогроХрпНроХро┐роЯрпБ",
    reset: "роорпАроЯрпНроЯроорпИроХрпНроХро╡рпБроорпН",
    deviceTitle: "роЪро╛родрой ро╡ро┐ро╡ро░роЩрпНроХро│рпН",
    summaryTitle: "роЪрпБро░рпБроХрпНроХроорпН",
    aiWelcome: "ро╡рогроХрпНроХроорпН! роХроЯрпНроЯрогроЩрпНроХро│рпН, рооро┐ройрпНроЪро╛ро░роорпН роЪрпЗрооро┐рокрпНрокрпБ роЕро▓рпНро▓родрпБ рокро┐ро▓рпНро▓рпИроХрпН роХрпБро▒ро┐родрпНродрпБ роХрпЗро│рпБроЩрпНроХро│рпН.",
  }
};

// ----------- Region-wise slabs -----------
const regionSlabs = {
  ap: [[50, 1.5], [100, 3.0], [200, 5.0], [Infinity, 7.0]],
  tn: [[100, 2.0], [200, 3.5], [500, 6.0], [Infinity, 8.0]],
  mh: [[100, 3.0], [300, 5.5], [500, 7.0], [Infinity, 9.0]]
};

// ----------- Appliance Power -----------
const applianceWatts = {
  "Fan": 75,
  "Tube Light": 40,
  "LED Bulb": 10,
  "Air Conditioner": 1200,
  "Refrigerator": 150,
  "Laptop": 60,
  "TV": 120,
  "Washing Machine": 500,
  "Microwave": 1000
};

// ----------- Language change handler -----------
const languageSelect = document.getElementById('language');
languageSelect.addEventListener('change', changeLanguage);

function changeLanguage() {
  const lang = languageSelect.value;
  const t = translations[lang];
  document.getElementById('headerText').innerText = t.header;
  document.getElementById('langLabel').innerText = t.lang;
  document.getElementById('regionLabel').innerText = t.region;
  document.getElementById('addDevice').innerText = t.add;
  document.getElementById('calculate').innerText = t.calc;
  document.getElementById('reset').innerText = t.reset;
  document.getElementById('deviceTitle').innerText = t.deviceTitle;
  document.getElementById('summaryTitle').innerText = t.summaryTitle;
  document.getElementById('chatHeader').innerText = "ЁЯдЦ " + t.header;
  document.getElementById('chatBody').innerHTML = `<div><strong>AI:</strong> ${t.aiWelcome}</div>`;
}

// ----------- Device row creation -----------
const devicesDiv = document.getElementById('devices');
function createDeviceRow() {
  const row = document.createElement('div');
  row.className = 'device-row';
  let opts = `<option value="">Select Appliance</option>`;
  for (const a in applianceWatts) opts += `<option value="${a}">${a}</option>`;
  row.innerHTML = `
    <select class="dev-name">${opts}</select>
    <input type="text" placeholder="Custom Appliance" class="dev-custom">
    <input type="number" placeholder="Power (W)" class="dev-power">
    <input type="number" placeholder="Hours/day" class="dev-hrs">
    <button class="remove-btn">X</button>
  `;
  const sel = row.querySelector('.dev-name');
  const custom = row.querySelector('.dev-custom');
  const power = row.querySelector('.dev-power');
  sel.addEventListener('change', () => {
    if (sel.value) {
      custom.disabled = true;
      power.value = applianceWatts[sel.value];
    } else {
      custom.disabled = false;
      power.value = '';
    }
  });
  row.querySelector('.remove-btn').onclick = () => row.remove();
  devicesDiv.appendChild(row);
}

// ----------- Calculate bill -----------
function calculateBill(units, slabs) {
  let total = 0, rem = units;
  for (const [limit, rate] of slabs) {
    const use = Math.min(rem, limit);
    total += use * rate;
    rem -= use;
    if (rem <= 0) break;
  }
  return total;
}

document.getElementById('addDevice').onclick = createDeviceRow;
document.getElementById('reset').onclick = () => { devicesDiv.innerHTML=''; document.getElementById('resultsArea').style.display='none'; };

document.getElementById('calculate').onclick = () => {
  const region = document.getElementById('region').value;
  const slabs = regionSlabs[region];
  const devices = Array.from(devicesDiv.querySelectorAll('.device-row')).map(r => ({
    name: r.querySelector('.dev-name').value || r.querySelector('.dev-custom').value || "Unnamed",
    power: parseFloat(r.querySelector('.dev-power').value) || 0,
    hrs: parseFloat(r.querySelector('.dev-hrs').value) || 0
  }));

  if (!devices.length) { alert('Add at least one device'); return; }

  let totalUnits = 0, html = '';
  devices.forEach(d => {
    const monthly = (d.power/1000)*d.hrs*30;
    totalUnits += monthly;
    html += `<p><strong>${d.name}</strong>: ${monthly.toFixed(2)} units/month</p>`;
  });
  const totalCost = calculateBill(totalUnits, slabs);
  document.getElementById('deviceList').innerHTML = html;
  document.getElementById('summaryContent').innerHTML = `
    <p><strong>Monthly Units:</strong> ${totalUnits.toFixed(2)}</p>
    <p><strong>Estimated Bill:</strong> тВ╣${totalCost.toFixed(2)}</p>
  `;
  document.getElementById('resultsArea').style.display = 'grid';
};

// ----------- AI Chat -----------
document.getElementById('sendMsg').onclick = () => {
  const msg = document.getElementById('userMsg').value.trim();
  if (!msg) return;
  const body = document.getElementById('chatBody');
  body.innerHTML += `<div><strong>You:</strong> ${msg}</div>`;
  let reply = "IтАЩm not sure. Please rephrase your question.";
  const m = msg.toLowerCase();
  if (m.includes("tariff")) reply = "Tariff slabs define rates for different electricity usage ranges.";
  else if (m.includes("reduce")) reply = "Switch off unused devices and use LED bulbs to reduce power usage.";
  else if (m.includes("bill")) reply = "Your bill depends on the units used and region-specific rates.";
  else if (m.includes("region")) reply = "Each region has its own tariff policy. Choose it from the dropdown.";
  body.innerHTML += `<div><strong>AI:</strong> ${reply}</div>`;
  document.getElementById('userMsg').value = '';
  body.scrollTop = body.scrollHeight;
};

// initial setup
createDeviceRow();
</script>
</body>
</html>
