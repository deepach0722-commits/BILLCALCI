<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Smart Energy Bill Calculator ‚ö°</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Poppins", sans-serif;
      margin:0; padding:0;
      background: linear-gradient(135deg, #90f7ec, #32ccbc);
      color:#222;
      min-height:100vh;
      display:flex; flex-direction:column;
    }
    header {
      text-align:center; padding:30px 10px;
      color:#fff;
    }
    header h1 {
      margin:0; font-size:32px;
      text-shadow:2px2px8px rgba(0,0,0,0.3);
    }
    header p { margin-top:8px; font-size:15px; color:#f0f0f0; }
    .container {
      max-width:900px;
      margin:20px auto 50px;
      background:rgba(255,255,255,0.95);
      border-radius:20px;
      padding:25px;
      box-shadow:0 10px 30px rgba(0,0,0,0.2);
      backdrop-filter:blur(10px);
    }
    .controls, .device-row {
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
    }
    .device-row {
      margin-bottom:12px; transition:0.3s;
    }
    .device-row:hover { background:#f8fcff; border-radius:12px; }
    select, input {
      padding:10px; font-size:15px;
      border:1px solid #ddd; border-radius:10px; flex:1;
      transition:0.25s; background:#fff;
    }
    select:focus, input:focus {
      border-color:#00bcd4; box-shadow:0 0 6px #99f1ff;
    }
    button {
      padding:10px 16px; font-size:15px; cursor:pointer;
      border:none; border-radius:10px; transition:all 0.3s ease;
      color:white;
    }
    button:hover { transform:scale(1.05); }
    #addDevice { background:#28a745; }
    #calculate { background:#007bff; }
    #reset { background:#ff4757; }
    .remove-btn { background:#fcecec; color:#333; border:1px solid #ffb0b0; }

    .cards {
      display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:25px;
    }
    .card {
      background:#fff; border-radius:16px; padding:18px;
      box-shadow:0 5px 20px rgba(0,0,0,0.1); transition:0.3s;
    }
    .card:hover { transform:translateY(-5px); }
    h3 { color:#007bff; }
    .suggestions h4 { color:#00bcd4; }
    .controls { margin-top:16px; }

    .awareness {
      margin-top:30px;
      background: linear-gradient(90deg, #fafff6, #e8ffe9);
      padding:16px; border-radius:12px;
      display:flex; align-items:center; gap:15px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
    }
    .awareness img { width:60px; height:60px; }
    .awareness p { margin:0; font-weight:500; color:#1a7f1a; }

    .chat-assistant {
      position:fixed; bottom:20px; right:20px;
      width:300px; max-width:90%;
      background:#fff; border-radius:16px; box-shadow:0 4px 16px rgba(0,0,0,0.2);
      display:flex; flex-direction:column; overflow:hidden;
    }
    .chat-header {
      background:#007bff; color:white; padding:12px; font-size:16px;
    }
    .chat-body { flex:1; padding:8px; max-height:300px; overflow-y:auto; }
    .chat-input { display:flex; border-top:1px solid #ddd; }
    .chat-input input {
      flex:1; padding:10px; border:none; outline:none;
    }
    .chat-input button {
      padding:10px; background:#00bcd4; color:white; border:none;
    }
    /* language selector */
    .top-controls { display:flex; gap:10px; margin-bottom:20px; }
    label { font-weight:600; }
    @media(max-width:700px) {
      .cards { grid-template-columns:1fr; }
      header h1 { font-size:26px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>‚ö° Smart Energy Bill Calculator</h1>
    <p>Select region, language, then add appliances & usage to calculate cost + chat for help.</p>
  </header>

  <div class="container">
    <div class="top-controls">
      <label for="langSelect">Language:</label>
      <select id="langSelect">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      </select>

      <label for="regionSelect">Region/State:</label>
      <select id="regionSelect">
        <option value="delhi">Delhi</option>
        <option value="tamilnadu">Tamil Nadu</option>
        <option value="kerala">Kerala</option>
        <option value="generic">Generic India</option>
      </select>
    </div>

    <div id="devices"></div>

    <div class="controls">
      <button id="addDevice">+ Add Appliance</button>
      <button id="calculate">Calculate</button>
      <button id="reset">Reset</button>
    </div>

    <div class="cards" id="resultsArea" style="display:none;">
      <div class="card" id="deviceDetails">
        <h3>üìä Appliance-wise Energy & Cost</h3>
        <div id="deviceList"></div>
      </div>
      <div class="card" id="summary">
        <h3>üí° Summary & Suggestions</h3>
        <div id="summaryContent"></div>
        <div class="suggestions" id="suggestions"></div>
      </div>
    </div>

    <div class="awareness">
      <img src="https://cdn-icons-png.flaticon.com/512/1161/1161793.png" alt="Save">
      <p>‚ö†Ô∏è Switch off lights, fans and TV when not in use ‚Äî save power & the planet üåç</p>
    </div>
  </div>

  <!-- Chat assistant -->
  <div class="chat-assistant">
    <div class="chat-header">Energy Helper Chat</div>
    <div class="chat-body" id="chatBody">
      <div><em>Hi! Ask me about tariffs, slabs, how to save electricity & your bill.</em></div>
    </div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Type your question...">
      <button id="chatSend">Send</button>
    </div>
  </div>

<script>
// --- language texts
const texts = {
  en: {
    language: "English",
    tip: "Choose appliance or type your own. Enter hours/day then calculate.",
    daily: "Daily Cost",
    weekly: "Weekly Cost",
    monthly: "Monthly Cost",
    additionalCharges: "Additional Charges (due to slab crossing/fixed charges)",
    // ‚Ä¶ you can extend as needed
  },
  hi: {
    language: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",
    tip: "‡§∏‡•Ç‡§ö‡•Ä ‡§∏‡•á ‡§â‡§™‡§ï‡§∞‡§£ ‡§ö‡•Å‡§®‡•á‡§Ç ‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§ ‡§™‡•ç‡§∞‡§§‡§ø‡§¶‡§ø‡§® ‡§ò‡§Ç‡§ü‡•á ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç ‡§´‡§ø‡§∞ ‡§ï‡§∞‡§ï‡•á ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
    daily: "‡§¶‡•à‡§®‡§ø‡§ï ‡§≤‡§æ‡§ó‡§§",
    weekly: "‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï ‡§≤‡§æ‡§ó‡§§",
    monthly: "‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§≤‡§æ‡§ó‡§§",
    additionalCharges: "‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∂‡•Å‡§≤‡•ç‡§ï (‡§∏‡•ç‡§≤‡•à‡§¨ ‡§â‡§Ç‡§≤‡§ò‡§®/‡§´‡§ø‡§ï‡•ç‡§∏‡•ç‡§° ‡§ö‡§æ‡§∞‡•ç‡§ú ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£)",
  }
};

// --- regional tariff data
const regionTariffs = {
  delhi: {
    slabs: [
      { upto:200, rate:3.00 },
      { upto:400, rate:4.50 },
      { upto:800, rate:6.50 },
      { upto:1200, rate:7.00 },
      { upto:Infinity, rate:8.00 }
    ],
    fixedChargePerKW: 20 // per kW/month for up to 2kW
  },
  tamilnadu: {
    slabs: [
      { upto:400, rate:4.80 },
      { upto:500, rate:6.45 },
      { upto:600, rate:8.55 },
      { upto:800, rate:9.65 },
      { upto:Infinity, rate:10.70 }
    ],
    fixedChargePerKW: 30
  },
  kerala: {
    slabs: [
      { upto:40, rate:1.50 },
      { upto:100, rate:4.25 },
      { upto:150, rate:5.35 },
      { upto:200, rate:7.20 },
      { upto:250, rate:8.50 },
      { upto:Infinity, rate:9.20 }
    ],
    fixedChargePerKW: 50
  },
  generic: {
    slabs: [
      { upto:300, rate:5.00 },
      { upto:600, rate:7.50 },
      { upto:Infinity, rate:10.00 }
    ],
    fixedChargePerKW: 40
  }
};

// --- Appliance wattages
const applianceWatts = {
  "Fan":75, "Tube Light":40, "LED Bulb":10,
  "Air Conditioner":1200, "Refrigerator":150, "Laptop":60,
  "TV":120, "Washing Machine":500, "Microwave":1000, "Iron":800, "Water Heater":1500
};

// Utility to estimate watts for manual entry
function estimateWatts(name) {
  name = name.toLowerCase();
  if(name.includes("ac")||name.includes("air")) return 1200;
  if(name.includes("heater")||name.includes("geyser")) return 1500;
  if(name.includes("fan")) return 75;
  if(name.includes("light")||name.includes("bulb")) return 15;
  if(name.includes("tv")) return 120;
  if(name.includes("laptop")||name.includes("computer")) return 60;
  if(name.includes("iron")) return 800;
  if(name.includes("pump")) return 500;
  if(name.includes("fridge")||name.includes("refrigerator")) return 150;
  return 150;
}

// Bill calculation given units and region
function calculateRegionalBill(units, regionKey, loadKW=0) {
  const region = regionTariffs[regionKey];
  let remaining = units;
  let cost = 0;
  for (let slab of region.slabs) {
    const use = Math.min(remaining, slab.upto);
    if(use <= 0) break;
    cost += use * slab.rate;
    remaining -= use;
    if(remaining <= 0) break;
  }
  const fixedCharge = loadKW * region.fixedChargePerKW;
  const total = cost + fixedCharge;
  return { cost: cost, fixedCharge: fixedCharge, total: total };
}

// Suggest reductions logic (as earlier)
function suggestReductions(devices, totalUnits, targetUnits, lang) {
  let excess = totalUnits - targetUnits;
  if(excess <=0) return [ lang==="en" ? "‚úÖ Already within target! Good job." : "‚úÖ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞! ‡§¨‡§π‡•Å‡§§ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ‡•§" ];
  const sorted = devices.slice().sort((a,b)=> (b.power*b.hrs)-(a.power*a.hrs) );
  const suggestions = [];
  for(let d of sorted) {
    if(excess<=0) break;
    const monthlyUnits = (d.power/1000)*d.hrs*30;
    const reduce = Math.min(monthlyUnits, excess);
    const newHrs = ((monthlyUnits-reduce)/(d.power/1000))/30;
    suggestions.push( lang==="en"
      ? `Reduce ${d.name} usage to ${newHrs.toFixed(1)} hrs/day to save ~${reduce.toFixed(1)} units.`
      : `${d.name} ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ${newHrs.toFixed(1)} ‡§ò‡§Ç‡§ü‡•á/‡§¶‡§ø‡§® ‡§§‡§ï ‡§ï‡§∞‡•á‡§Ç ~${reduce.toFixed(1)} ‡§Ø‡•Ç‡§®‡§ø‡§ü ‡§¨‡§ö‡§æ‡§è‡§Å‡•§`
    );
    excess -= reduce;
  }
  return suggestions;
}

// Generate slab suggestions
function generateSlabSuggestions(devices, totalUnits, regionKey, lang) {
  const region = regionTariffs[regionKey];
  const slabLimits = region.slabs.map(s=>s.upto).filter(u=>u!==Infinity);
  const crossed = slabLimits.filter(lim=> totalUnits > lim);
  let html="";
  if(crossed.length===0) {
    html += `<p>${lang==="en" ? "üëè Excellent! You‚Äôre within the lowest consumption slab." : "üëè ‡§∂‡§æ‡§®‡§¶‡§æ‡§∞! ‡§Ü‡§™ ‡§∏‡§¨‡§∏‡•á ‡§ï‡§Æ ‡§∏‡•ç‡§≤‡•à‡§¨ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§π‡•à‡§Ç‡•§"}</p>`;
  } else {
    html += `<p>${lang==="en" ? "‚ö° You‚Äôve crossed " : "‚ö° ‡§Ü‡§™‡§®‡•á "}${crossed.length}${lang==="en" ? " slab(s) (up to " : " ‡§∏‡•ç‡§≤‡•à‡§¨ ‡§™‡§æ‡§∞ ‡§ï‡§ø‡§Ø‡§æ (‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ")}${crossed.at(-1)} ${lang==="en" ? "units)." : " ‡§Ø‡•Ç‡§®‡§ø‡§ü) ‡§§‡§ï‡•§"}</p>`;
    crossed.reverse().forEach(slab => {
      const tips = suggestReductions(devices,totalUnits,slab,lang);
      const { total:newCost } = calculateRegionalBill(slab,regionKey);
      html += `
        <h4>${lang==="en" ? "To reduce to ‚â§ " : "‚â§ "}${slab} ${lang==="en"?" units:":" ‡§Ø‡•Ç‡§®‡§ø‡§ü ‡§§‡§ï:"}</h4>
        <ul>${tips.map(t=>`<li>${t}</li>`).join('')}</ul>
        <p><em>${lang==="en" ? "üí∞ New Bill ‚âà ‚Çπ" : "üí∞ ‡§®‡§Ø‡§æ ‡§¨‡§ø‡§≤ ‚âà ‚Çπ"}${newCost.toFixed(2)}</em></p>
      `;
    });
  }
  return html;
}

// UI & event logic
const devicesDiv = document.getElementById('devices');
const addBtn = document.getElementById('addDevice');
const calcBtn = document.getElementById('calculate');
const resetBtn = document.getElementById('reset');
const resultsArea = document.getElementById('resultsArea');
const deviceListDiv = document.getElementById('deviceList');
const summaryContentDiv = document.getElementById('summaryContent');
const suggestionsDiv = document.getElementById('suggestions');
const langSelect = document.getElementById('langSelect');
const regionSelect = document.getElementById('regionSelect');

let currentLang = "en";
langSelect.addEventListener('change', ()=> {
  currentLang = langSelect.value;
  // you could update UI text labels here accordingly
});

function createDeviceRow() {
  const row = document.createElement('div');
  row.className = 'device-row';
  let options = `<option value="">Select Appliance</option>`;
  for (const app in applianceWatts) {
    options += `<option value="${app}">${app}</option>`;
  }
  row.innerHTML = `
    <select class="dev-name">${options}</select>
    <input type="text" placeholder="Or type appliance name" class="dev-custom" />
    <input type="number" placeholder="Power (W)" class="dev-power" step="any">
    <input type="number" placeholder="Hours/day" class="dev-hrs" step="any">
    <button class="remove-btn">‚úñ</button>
  `;
  const select = row.querySelector('.dev-name');
  const custom = row.querySelector('.dev-custom');
  const powerInput = row.querySelector('.dev-power');
  const hrsInput = row.querySelector('.dev-hrs');
  const removeBtn = row.querySelector('.remove-btn');

  removeBtn.addEventListener('click', ()=> row.remove());

  select.addEventListener('change', ()=> {
    if(select.value) {
      custom.disabled = true;
      powerInput.value = applianceWatts[select.value];
    } else {
      custom.disabled = false;
      powerInput.value = '';
    }
  });

  custom.addEventListener('input', ()=> {
    if(custom.value.trim()) {
      select.disabled = true;
      powerInput.value = estimateWatts(custom.value);
    } else {
      select.disabled = false;
      powerInput.value = '';
    }
  });

  devicesDiv.appendChild(row);
}

addBtn.addEventListener('click', ()=> createDeviceRow());
resetBtn.addEventListener('click', ()=>{
  devicesDiv.innerHTML = '';
  resultsArea.style.display='none';
  createDeviceRow();
});

calcBtn.addEventListener('click', ()=>{
  const regionKey = regionSelect.value;
  const rows = devicesDiv.querySelectorAll('.device-row');
  if(rows.length === 0) {
    alert(currentLang==="en" ? "Add at least one appliance." : "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ-‡§∏‡•á-‡§ï‡§Æ ‡§è‡§ï ‡§â‡§™‡§ï‡§∞‡§£ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§");
    return;
  }
  const devices = Array.from(rows).map(r=>{
    const select = r.querySelector('.dev-name');
    const custom = r.querySelector('.dev-custom');
    const power = parseFloat(r.querySelector('.dev-power').value) || 0;
    const hrs = parseFloat(r.querySelector('.dev-hrs').value) || 0;
    const name = select.disabled ? (custom.value.trim() || "Unnamed Device") : (select.value || "Unnamed Device");
    return { name, power, hrs };
  });

  // Calculate totals
  let totalMonthlyUnits=0;
  let deviceDetailsHTML="";
  devices.forEach(d=>{
    const dailyUnits = (d.power/1000)*d.hrs;
    const weeklyUnits = dailyUnits * 7;
    const monthlyUnits = dailyUnits * 30;
    totalMonthlyUnits += monthlyUnits;
    const billInfo = calculateRegionalBill(monthlyUnits, regionKey);
    deviceDetailsHTML += `
      <div><strong>${d.name}</strong>: ${dailyUnits.toFixed(2)} units/day, ${weeklyUnits.toFixed(2)} units/week, ${monthlyUnits.toFixed(2)} units/month ‚Üí ‚Çπ${billInfo.total.toFixed(2)}</div>
    `;
  });

  // Overall totals
  const overallBillInfo = calculateRegionalBill(totalMonthlyUnits, regionKey);
  summaryContentDiv.innerHTML = `
    <p><strong>${texts[currentLang].monthly}:</strong> ${totalMonthlyUnits.toFixed(2)} units &nbsp;&nbsp; <strong>‚Çπ${overallBillInfo.total.toFixed(2)}</strong></p>
    <p><strong>${texts[currentLang].additionalCharges}:</strong> ‚Çπ${overallBillInfo.fixedCharge.toFixed(2)}</p>
  `;

  deviceListDiv.innerHTML = deviceDetailsHTML;
  suggestionsDiv.innerHTML = generateSlabSuggestions(devices, totalMonthlyUnits, regionKey, currentLang);

  resultsArea.style.display='grid';
});

// Initialize
createDeviceRow();

// --- Chat assistant logic
const chatBody = document.getElementById('chatBody');
const chatInput = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');

const faqResponses = {
  "what are tariff slabs": "Tariff slabs are different consumption ranges where electricity rate per unit varies. Lower usage often has lower rate and higher usage pays higher rate.",
  "why fixed charges": "Fixed charges are monthly fees charged irrespective of usage. They cover infrastructure and connection costs.",
  "how to reduce electricity bill": "Some tips: turn off appliances when not in use, use LED bulbs, avoid high-power devices during peak time, maintain AC filters, optimise usage hours.",
  "what happens if i cross a slab": "When you cross a slab, your rate per unit increases or entire consumption might get charged at higher rate depending on state. Also fixed charges may increase.",
  "delhi slab": "In Delhi: 0-200 units at ‚Çπ3.00/kWh, 201-400 at ‚Çπ4.50, 401-800 at ‚Çπ6.50, 801-1200 at ‚Çπ7.00, above 1200 at ‚Çπ8.00. Fixed: ‚Çπ20/kW/month (up to 2kW).",
  "tamil nadu slab": "In Tamil Nadu: up to 400 units at ‚Çπ4.80/kWh, 401-500 at ‚Çπ6.45, 501-600 at ‚Çπ8.55, 601-800 at ‚Çπ9.65, above 800 at ‚Çπ10.70. Fixed: ‚Çπ30/kW/month."
};

chatSend.addEventListener('click', ()=> {
  const q = chatInput.value.trim().toLowerCase();
  if(!q) return;
  const userHtml = `<div style="text-align:right; margin:4px 0;"><strong>You:</strong> ${chatInput.value}</div>`;
  chatBody.innerHTML += userHtml;
  chatInput.value = '';
  let resp = faqResponses[q] || "Sorry, I don't understand that yet. Ask about slabs, fixed charges or how to save electricity.";
  const botHtml = `<div style="margin:4px 0;"><strong>Assistant:</strong> ${resp}</div>`;
  chatBody.innerHTML += botHtml;
  chatBody.scrollTop = chatBody.scrollHeight;
});
</script>

</body>
</html>
